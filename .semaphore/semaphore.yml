version: v1.0
name: First pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Build Flask Image
    dependencies:
      - Checkout
    task:
      jobs:
        - name: Docker
          commands:
            - docker build -t tic-tac-qu-postgres -f docker/PostgresDBImage/Dockerfile .
  - name: Build DB Image
    dependencies:
      - Checkout
    task:
      jobs:
        - name: Docker
          commands:
            - docker build -t tic-tac-qu-flask-test -f docker/FlaskImage/Dockerfile .
  - name: Build Compose Environment
    dependencies:
      - Build DB Image
      - Build Flask Image
    task:
      jobs:
        - name: Compose
          commands:
            - docker-compose -f Docker/ComposeTest/docker-compose.yml up
  - name: Checkout
    dependencies: []
    task:
      jobs:
        - name: Checkout
          commands:
            - checkout
      epilogue:
        always:
          commands:
            - ls
